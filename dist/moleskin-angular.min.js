/*! Moleskin - v0.1.0 - 2013-07-03 */Moleskin={},function(a){a.fn.moleskine=function(a){return new b(this,a||{})};var b=function(b,c){if(this.width=c.width||a(b).width()||"100%",this.height=c.height||a(b).height()||350,this.change=this.onChange=c.change||function(){},this.output=c.output||null,this.input=c.input||null,this.defaultMode=c.defaultMode||"html",this.autoGrow=c.autoGrow||!0,this.mode="html",this.main_el=b,this.iframe=null,this.iframe_doc=null,this.textarea=null,this.event=null,this.range=null,this.toolbars={rte:"",html:"",md:""},"undefined"==typeof Showdown)throw new Error("Showdown.js must be included");if("undefined"==typeof reMarked)throw new Error("Remarked.js must be included");this.showdown=new Showdown.converter,this.reMarked=new reMarked({link_list:!1,h1_setext:!1,h2_setext:!1,h_atx_suf:!1,gfm_code:!1,li_bullet:"-",hr_char:"-",indnt_str:"    ",bold_char:"*",emph_char:"_",gfm_del:!0,gfm_tbls:!0,tbl_edges:!1,hash_lnks:!1,br_only:!1}),this.controls={rte:{"md-enable":{hint:"Markdown"},disable:{hint:"Source editor"}},html:{enable:{hint:"Visual editor"}},md:{"md-disable":{hint:"Switch to html"}}},a.extend(this.controls.rte,MoleskinConf.rte_toolbar||{}),a.extend(this.controls.html,MoleskinConf.html_toolbar||{}),a.extend(this.controls.md,MoleskinConf.md_toolbar||{}),this.init(b)};b.prototype.init=function(b){(document.designMode||document.contentEditable)&&(a(b).wrap(a("<div></div>").addClass("rte-zone").width(this.width)),a(b).parents(".rte-zone").append(this.info_el),this.info_el=a(b).parent().find("rte-infos").html(),this.textarea=b,this.enable_design_mode(),"markdown"==this.defaultMode&&this.html_to_markdown())},b.prototype.get_markdown=function(){var b=this;return"markdown"==this.mode?a(b.textarea).val():"rawhtml"==this.mode?b.reMarked.render(a(b.textarea).val()):b.reMarked.render(a("body",b.iframe_doc).html())},b.prototype.get_html=function(){var b=this;return"markdown"==this.mode?this.showdown.makeHtml(a(b.textarea).val()):"rawhtml"==this.mode?a(b.textarea).val():a("body",b.iframe_doc).html()},b.prototype.enable_design_mode=function(){var b=a(this.textarea).val();this.mode="html",this.put_in_iframe(b)},b.prototype.markdown_to_html=function(){var b=a(this.textarea).val(),c=this.showdown.makeHtml(b);this.mode="html",this.put_in_iframe(c)},b.prototype.html_to_markdown=function(){var b;b=this.iframe_doc?this.reMarked.render(a("body",this.iframe_doc).html()):a(this.textarea).val(),this.mode="markdown",this.create_textarea(b,this.toolbars.md,this.controls.md)},b.prototype.disable_design_mode=function(){var b=a("body",this.iframe_doc).html();this.mode="rawhtml",this.create_textarea(b,this.toolbars.md,this.controls.md)},b.prototype.editor_cmd=function(a,b){var c=this;this.iframe.contentWindow.focus();try{this.iframe_doc.execCommand(a,!1,b)}catch(d){console.log(d)}this.iframe.contentWindow.focus(),c.change(null,c.get_content())},b.prototype.create_textarea=function(b,c,d,e){var f=this;this.textarea=e?a('<input type="hidden" />').get(0):a("<textarea></textarea>"),this.textarea.width(f.width).height(this.height).get(0),a(this.textarea).val(b),a(this.iframe).before(this.textarea),1==f.autoGrow&&a(this.textarea).autogrow(),a(this.textarea).keyup(function(){f.change(null,f.get_content())}),c||(c=this.create_toolbar(d)),1!=e&&(a(this.iframe_doc).remove(),a(this.iframe).remove(),this.iframe=this.iframe_doc=null,this.activate_toolbar(this.textarea,c)),a(this.textarea).focus()},b.prototype.get_toolbar=function(){var b=this.iframe?a(this.iframe):a(this.textarea);return b.prev().hasClass("rte-toolbar")?b.prev():null},b.prototype.activate_toolbar=function(b,c){var d=this.get_toolbar();d&&d.remove(),a(b).before(a(c).clone(!0))},b.prototype.update_iframe=function(a){var b="<html><head></head><body style=\"font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding : 0; margin : 0; overflow:hidden;\">"+a+"</body></html>";this.iframe_doc.open(),this.iframe_doc.write(b),this.iframe_doc.close()},b.prototype.put_in_iframe=function(b){var c=this;c.iframe=null,c.iframe=document.createElement("iframe"),c.iframe.frameBorder=0,c.iframe.frameMargin=0,c.iframe.framePadding=0,c.iframe.width="100%",c.iframe.height=c.height||"100%",c.iframe.src="javascript:void(0);",a(c.textarea).hide().after(c.iframe).remove(),c.textarea=null,c.iframe_doc=c.iframe.contentWindow.document;try{c.iframe_doc.designMode="on"}catch(d){a(c.iframe_doc).focus(function(){c.iframe_doc.designMode()})}c.update_iframe(b),c.toolbars.rte||(c.toolbars.rte=c.create_toolbar(c.controls.rte)),c.activate_toolbar(c.iframe,c.toolbars.rte),a(c.iframe_doc).mouseup(function(a){c.iframe_doc.selection&&(c.range=c.iframe_doc.selection.createRange()),c.set_selected_controls(a.target?a.target:a.srcElement,c.controls.rte)}),a(c.iframe_doc).blur(function(){c.iframe_doc.selection&&(c.range=c.iframe_doc.selection.createRange())}),a(c.iframe_doc).keyup(function(){1==c.autoGrow&&a(c.iframe).height(a(c.iframe_doc).contents().find("body").height()),c.change(null,c.get_content()),c.set_selected_controls(c.get_selected_element(),c.controls.rte)}),navigator.userAgent.match(/msie/i)||c.editor_cmd("styleWithCSS",!1)},b.prototype.toolbar_click=function(b,c){var d=c.exec,e=c.args||[],f="SELECT"==b.tagName.toUpperCase();if(a(".rte-panel",this.get_toolbar()).remove(),d){f&&e.push(b);try{d.apply(this,e)}catch(g){}}else if(this.iframe&&c.command){if(f&&(e=b.options[b.selectedIndex].value,e.length<=0))return;this.editor_cmd(c.command,e)}},b.prototype.create_toolbar=function(b){var c=this,d=a("<div></div>").addClass("rte-toolbar").width("100%").append(a("<ul></ul>")).append(a("<div></div>").addClass("clear"));c.tb=d.get(0);var e,f;for(var g in b){if(b[g].separator)f=a("<li></li>").addClass("separator");else{if(b[g].init)try{b[g].init.apply(b[g],[this])}catch(h){}e=b[g].select?a(b[g].select).change(function(a){return c.event=a,c.toolbar_click(this,b[this.className]),!1}):a("<a href='#'></a>").attr("title",b[g].hint?b[g].hint:g).attr("rel",g).click(function(a){return c.event=a,c.toolbar_click(this,b[this.rel]),!1}),f=a("<li></li>").append(e.addClass(g))}a("ul",d).append(f)}return a(".md-enable",d).click(function(){return c.html_to_markdown(),!1}),a(".md-disable",d).click(function(){return c.markdown_to_html(),!1}),a(".enable",d).click(function(){return c.enable_design_mode(),!1}),a(".disable",d).click(function(){return c.disable_design_mode(),!1}),d.get(0)},b.prototype.create_panel=function(b,c){var d=this,e=d.get_toolbar();if(!e)return!1;a(".rte-panel",e).remove();var f,g,h=d.event.pageX,i=d.event.pageY,j=a("<div></div>").hide().addClass("rte-panel").css({left:h,top:i});return a("<div></div>").addClass("rte-panel-title").html(b).append(a("<a class='close' href='#'>X</a>").click(function(){return j.remove(),!1})).mousedown(function(){return f=!0,!1}).mouseup(function(){return f=!1,!1}).mousemove(function(a){return f&&g&&(h-=g.pageX-a.pageX,i-=g.pageY-a.pageY,j.css({left:h,top:i})),g=a,!1}).appendTo(j),c&&j.width(c),e.append(j),j},b.prototype.get_content=function(){var b;return b="markdown"==this.output?this.get_markdown():"html"==this.output?this.get_html():this.iframe?a("body",this.iframe_doc).html():a(this.textarea).val()},b.prototype.set_content=function(b){if("markdown"==this.input)this.iframe?a("body",this.iframe_doc).html(this.showdown.makeHtml(b)):a(this.textarea).val(b);else{if("html"!=this.input)throw new Error("input not defined in options [markdown, html]");this.iframe?a("body",this.iframe_doc).html(b):a(this.textarea).val(b)}},b.prototype.set_selected_controls=function(b,c){var d=this.get_toolbar();if(!d)return!1;var e,f,g,h,i,j,k;try{for(e in c)if(h=c[e],g=a("."+e,d),g.removeClass("active"),h.tags){f=b;do if(1==f.nodeType&&(i=f.nodeName.toLowerCase(),!(a.inArray(i,h.tags)<0)))if(h.select){if(g=g.get(0),"SELECT"==g.tagName.toUpperCase())for(g.selectedIndex=0,j=0;j<g.options.length;j++)if(k=g.options[j].value,k&&(h.tag_cmp&&h.tag_cmp(f,k)||i==k)){g.selectedIndex=j;break}}else g.addClass("active");while(f=f.parentNode)}}catch(l){}return!0},b.prototype.get_selected_element=function(){var a,b,c,d=this.iframe.contentWindow;if(d.getSelection)try{b=d.getSelection(),c=b.getRangeAt(0),a=c.commonAncestorContainer}catch(e){return!1}else try{b=d.document.selection,c=b.createRange(),a=c.parentElement()}catch(e){return!1}return a},b.prototype.get_selection_range=function(){var a=null,b=this.iframe.contentWindow;if(this.iframe.focus(),b.getSelection){if(a=b.getSelection().getRangeAt(0),navigator.userAgent.match(/opera/i)){var c=a.startContainer;c.nodeType===Node.TEXT_NODE&&a.setStartBefore(c.parentNode)}}else this.range.select(),a=this.iframe_doc.selection.createRange();return a},b.prototype.get_selected_text=function(){var a=this.iframe.contentWindow;return a.getSelection?a.getSelection().toString():(this.range.select(),a.document.selection.createRange().text)},b.prototype.get_selected_html=function(){var a=null,b=this.iframe.contentWindow,c=this.get_selection_range();if(c)if(b.getSelection){var d=document.createElement("div");d.appendChild(c.cloneContents()),a=d.innerHTML}else a=c.htmlText;return a},b.prototype.selection_replace_with=function(a){var b=this.get_selection_range(),c=this.iframe.contentWindow;b&&(this.editor_cmd("removeFormat"),c.getSelection?(b.deleteContents(),b.insertNode(b.createContextualFragment(a)),this.editor_cmd("delete")):(this.editor_cmd("delete"),b.pasteHTML(a)))};var c=function(b){this.drag=!1,this.rte_zone=a(b).parents(".rte-zone")};c.mousedown=function(b,c){return b.drag=!0,b.event="undefined"==typeof c?window.event:c,b.rte_obj=a(".rte-resizer",b.rte_zone).prev().eq(0),a("body",document).css("cursor","se-resize"),!1},c.mouseup=function(b){return b.drag=!1,a("body",document).css("cursor","auto"),!1},c.mousemove=function(a,b){if(a.drag){b="undefined"==typeof b?window.event:b;var c=Math.max(1,a.rte_zone.width()+b.screenX-a.event.screenX),d=Math.max(1,a.rte_obj.height()+b.screenY-a.event.screenY);a.rte_zone.width(c),a.rte_obj.height(d),a.event=b}return!1}}(jQuery,"undefined"==typeof window?this:window),MoleskinConf={},function(a,b){function c(){var b=this,c=b.create_panel("Insert image",385);c.append('                 <p><label>URL</label><input type="text" id="url" size="30" value=""><button id="file">Upload</button><button id="view">View</button></p>                 <div class="clear"></div>                 <p class="submit"><button id="ok">Ok</button><button id="cancel">Cancel</button></p>').show();var d=a("#url",c);a("#view",c).click(function(){return d.val().length>0?window.open(d.val()):alert("Enter URL of image to view"),!1}),a("#cancel",c).click(function(){return c.remove(),!1}),a("#ok",c).click(function(){var a=d.val();return console.log("ok"),b.editor_cmd("insertImage",a),c.remove(),!1})}function d(){this.editor_cmd("removeFormat"),this.editor_cmd("unlink")}function e(){confirm("Clear Document?")&&this.set_content("")}function f(){function a(a,b,c,d){if(a=a.replace(/<o:p>\s*<\/o:p>/g,""),a=a.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;"),a=a.replace(/\s*mso-[^:]+:[^;"]+;?/gi,""),a=a.replace(/\s*MARGIN: 0cm 0cm 0pt\s*;/gi,""),a=a.replace(/\s*MARGIN: 0cm 0cm 0pt\s*"/gi,'"'),a=a.replace(/\s*TEXT-INDENT: 0cm\s*;/gi,""),a=a.replace(/\s*TEXT-INDENT: 0cm\s*"/gi,'"'),a=a.replace(/\s*TEXT-ALIGN: [^\s;]+;?"/gi,'"'),a=a.replace(/\s*PAGE-BREAK-BEFORE: [^\s;]+;?"/gi,'"'),a=a.replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi,'"'),a=a.replace(/\s*tab-stops:[^;"]*;?/gi,""),a=a.replace(/\s*tab-stops:[^"]*/gi,""),b&&(a=a.replace(/\s*face="[^"]*"/gi,""),a=a.replace(/\s*face=[^ >]*/gi,""),a=a.replace(/\s*FONT-FAMILY:[^;"]*;?/gi,"")),a=a.replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3"),c&&(a=a.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gi,"<$1$3")),a=a.replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi,""),a=a.replace(/<(?:META|LINK)[^>]*>\s*/gi,""),a=a.replace(/\s*style="\s*"/gi,""),a=a.replace(/<SPAN\s*[^>]*>\s*&nbsp;\s*<\/SPAN>/gi,"&nbsp;"),a=a.replace(/<SPAN\s*[^>]*><\/SPAN>/gi,""),a=a.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3"),a=a.replace(/<SPAN\s*>([\s\S]*?)<\/SPAN>/gi,"$1"),a=a.replace(/<FONT\s*>([\s\S]*?)<\/FONT>/gi,"$1"),a=a.replace(/<\\?\?xml[^>]*>/gi,""),a=a.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,""),a=a.replace(/<\/?\w+:[^>]*>/gi,""),a=a.replace(/<\!--[\s\S]*?-->/g,""),a=a.replace(/<(U|I|STRIKE)>&nbsp;<\/\1>/g,"&nbsp;"),a=a.replace(/<H\d>\s*<\/H\d>/gi,""),a=a.replace(/<(\w+)[^>]*\sstyle="[^"]*DISPLAY\s?:\s?none[\s\S]*?<\/\1>/gi,""),a=a.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3"),a=a.replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3"),a=a.replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3"),d)a=a.replace(/<H(\d)([^>]*)>/gi,"<h$1>"),a=a.replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>"),a=a.replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");else{a=a.replace(/<H1([^>]*)>/gi,'<div$1><b><font size="6">'),a=a.replace(/<H2([^>]*)>/gi,'<div$1><b><font size="5">'),a=a.replace(/<H3([^>]*)>/gi,'<div$1><b><font size="4">'),a=a.replace(/<H4([^>]*)>/gi,'<div$1><b><font size="3">'),a=a.replace(/<H5([^>]*)>/gi,'<div$1><b><font size="2">'),a=a.replace(/<H6([^>]*)>/gi,'<div$1><b><font size="1">'),a=a.replace(/<\/H\d>/gi,"</font></b></div>");var e=new RegExp("(<P)([^>]*>[\\s\\S]*?)(</P>)","gi");a=a.replace(e,"<div$2</div>"),a=a.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,""),a=a.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,""),a=a.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")}return a}this.set_content(a(this.get_content(),!0,!0,!0))}function g(){var b=this,c=b.create_panel("Create link / Attach file",385);c.append('                 <p><label>URL</label><input type="text" id="url" size="30" value=""><button id="view">View</button></p>                 <div class="clear"></div>                 <p><label>Title</label><input type="text" id="title" size="30" value=""><label>Target</label><select id="target"><option value="">Default</option><option value="_blank">New window</option></select></p>                 <div class="clear"></div>                 <p class="submit"><button id="ok">Ok</button><button id="cancel">Cancel</button></p>').show(),a("#cancel",c).click(function(){return c.remove(),!1});var d=a("#url",c);a("#view",c).click(function(){return d.val().length>0?window.open(d.val()):alert("Enter URL to view"),!1}),a("#ok",c).click(function(){var d=a("#url",c).val(),e=a("#target",c).val(),f=a("#title",c).val();if(b.get_selected_text().length<=0)return alert("Select the text you wish to link!"),!1;if(c.remove(),d.length<=0)return!1;b.editor_cmd("unlink"),b.editor_cmd("createLink",d);var g=a("<span></span>").append(b.get_selected_html());return e.length>0&&a('a[href*="'+d+'"]',g).attr("target",e),f.length>0&&a('a[href*="'+d+'"]',g).attr("title",f),a('a[href*="'+h+'"]',g).attr("href",d),b.selection_replace_with(g.html()),!1})}b.rte_toolbar={s1:{separator:!0},bold:{command:"bold",tags:["b","strong"]},italic:{command:"italic",tags:["i","em"]},s2:{separator:!0},indent:{command:"indent"},s3:{separator:!0},orderedList:{command:"insertorderedlist",tags:["ol"]},unorderedList:{command:"insertunorderedlist",tags:["ul"]},s4:{separator:!0},h1:{command:"formatblock",args:"<h1>"},h2:{command:"formatblock",args:"<h2>"},h3:{command:"formatblock",args:"<h3>"},s5:{separator:!0},image:{exec:c,tags:["img"]},link:{exec:g,tags:["a"]},s6:{separator:!0},removeFormat:{exec:d},word:{exec:f},clear:{exec:e}},b.html_toolbar={s1:{separator:!0},word:{exec:f},clear:{exec:e}},b.md_toolbar={s1:{separator:!0},image:{exec:function(){alert("To implement depending on your workflow")},tags:["img"]},clear:{exec:e}};var h="-rte-p-tag-"}(jQuery,MoleskinConf,"undefined"==typeof window?this:window),reMarked=function(a){function b(a,b){if(!b)return a;for(var c in a)"undefined"!=typeof b[c]&&(a[c]=b[c])}function c(a,b){for(var c="";b-->0;)c+=a;return c}function d(a){for(var a=a.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)}function e(a){return a?"<"+a+">":""}function f(a){return a?"</"+a+">":""}function g(a,b){return a.replace(/^/gm,b)}function h(a){return("#text"==a.nodeName?"txt":a.nodeName).toLowerCase()}function i(a,b){var c,d;return b instanceof Array?(c=b[0],d=b[1]):c=d=b,c=c instanceof Function?c.call(this,a):c,d=d instanceof Function?d.call(this,a):d,c+a+d}var j=[],k={link_list:!1,h1_setext:!0,h2_setext:!0,h_atx_suf:!1,gfm_code:!1,li_bullet:"*-+"[0],hr_char:"-_*"[0],indnt_str:["    ","	","  "][0],bold_char:"*_"[0],emph_char:"*_"[1],gfm_del:!0,gfm_tbls:!0,tbl_edges:!1,hash_lnks:!1,br_only:!1};b(k,a),this.render=function(a){if("string"==typeof a){var b=a;a=document.createElement("div"),a.innerHTML=b}var d=new l.tag(a,null,0),e=d.rend().replace(/^[\t ]+\n/gm,"\n");if(k.link_list){e+="\n\n";var f=0;for(var g in j)if(j[g].e.title){var h=j[g].e.href.length;h&&h>f&&(f=h)}for(var i in j){var m=j[i].e.title?c(" ",f+2-j[i].e.href.length)+'"'+j[i].e.title+'"':"";e+="  ["+(+i+1)+"]: "+j[i].e.href+m+"\n"}}return e.replace(/^[\t ]+\n/gm,"\n")};var l={};l.tag=klass({wrap:"",lnPfx:"",lnInd:0,init:function(a,b,c){this.e=a,this.p=b,this.i=c,this.c=[],this.tag=h(a),this.initK()},initK:function(){var a;if(this.e.hasChildNodes()){var b,c,d=/^(?:a|strong|code|em|sub|sup|del|i|u|b|big|center)$/;for(a in this.e.childNodes)if(/\d+/.test(a)&&(b=this.e.childNodes[a],c=h(b),!/style|script|canvas|video|audio/.test(c))){if("txt"==c&&/^\s+$/.test(b.textContent)){if(0==a||a==this.e.childNodes.length-1)continue;var e=this.e.childNodes[a-1],f=this.e.childNodes[a+1];if(e&&!h(e).match(d)||f&&!h(f).match(d))continue}l[c]||(c="tag");var g=new l[c](b,this,this.c.length);(g instanceof l.a&&b.href||g instanceof l.img)&&(g.lnkid=j.length,j.push(g)),this.c.push(g)}}},rend:function(){return this.rendK().replace(/\n{3,}/gm,"\n\n")},rendK:function(){var a,b="";for(var c in this.c)a=this.c[c],b+=(a.bef||"")+a.rend()+(a.aft||"");return b.replace(/^\n+|\n+$/,"")}}),l.blk=l.tag.extend({wrap:["\n\n",""],wrapK:null,tagr:!1,lnInd:null,init:function(a,b,c){this.supr(a,b,c),null===this.lnInd&&(this.lnInd=this.p&&this.tagr&&this.c[0]instanceof l.blk?4:0),null===this.wrapK&&(this.wrapK=this.tagr&&this.c[0]instanceof l.blk?"\n":"")},rend:function(){return i.call(this,(this.tagr?e(this.tag):"")+i.call(this,g(g(this.rendK(),this.lnPfx),c(" ",this.lnInd)),this.wrapK)+(this.tagr?f(this.tag):""),this.wrap)},rendK:function(){var a=this.supr();if(this.p instanceof l.li){var b=null,c=a.match(/^[\t ]+/gm);if(!c)return a;for(var d in c)(null===b||c[d][0].length<b.length)&&(b=c[d][0]);return a.replace(new RegExp("^"+b),"")}return a}}),l.tblk=l.blk.extend({tagr:!0}),l.cblk=l.blk.extend({wrap:["\n",""]}),l.ctblk=l.cblk.extend({tagr:!0}),l.inl=l.tag.extend({rend:function(){return i.call(this,this.rendK(),this.wrap)}}),l.tinl=l.inl.extend({tagr:!0,rend:function(){return e(this.tag)+i.call(this,this.rendK(),this.wrap)+f(this.tag)}}),l.p=l.blk.extend({rendK:function(){return this.supr().replace(/^\s+/gm,"")}}),l.div=l.p.extend(),l.span=l.inl.extend(),l.list=l.blk.extend({expn:!1,wrap:[function(){return this.p instanceof l.li?"\n":"\n\n"},""]}),l.ul=l.list.extend({}),l.ol=l.list.extend({}),l.li=l.cblk.extend({wrap:["\n",function(a){return this.p.expn||a.match(/\n{2}/gm)?"\n":""}],wrapK:[function(){return"ul"==this.p.tag?k.li_bullet+" ":this.i+1+".  "},""],rendK:function(){return this.supr().replace(/\n([^\n])/gm,"\n"+k.indnt_str+"$1")}}),l.hr=l.blk.extend({wrap:["\n\n",c(k.hr_char,3)]}),l.h=l.blk.extend({}),l.h_setext=l.h.extend({}),k.h1_setext&&(l.h1=l.h_setext.extend({wrapK:["",function(a){return"\n"+c("=",a.length)}]})),k.h2_setext&&(l.h2=l.h_setext.extend({wrapK:["",function(a){return"\n"+c("-",a.length)}]})),l.h_atx=l.h.extend({wrapK:[function(){return c("#",this.tag[1])+" "},function(){return k.h_atx_suf?" "+c("#",this.tag[1]):""}]}),!k.h1_setext&&(l.h1=l.h_atx.extend({})),!k.h2_setext&&(l.h2=l.h_atx.extend({})),l.h3=l.h_atx.extend({}),l.h4=l.h_atx.extend({}),l.h5=l.h_atx.extend({}),l.h6=l.h_atx.extend({}),l.a=l.inl.extend({lnkid:null,rend:function(){var a=this.rendK(),b=this.e.getAttribute("href"),c=this.e.title?' "'+this.e.title+'"':"";return!b||b==a||"#"==b[0]&&!k.hash_lnks?a:k.link_list?"["+a+"] ["+(this.lnkid+1)+"]":"["+a+"]("+b+c+")"}}),l.img=l.inl.extend({lnkid:null,rend:function(){var a=this.e.alt,b=this.e.getAttribute("src");if(k.link_list)return"["+a+"] ["+(this.lnkid+1)+"]";var c=this.e.title?' "'+this.e.title+'"':"";return"!["+a+"]("+b+c+")"}}),l.em=l.inl.extend({wrap:k.emph_char}),l.i=l.em.extend(),l.del=k.gfm_del?l.inl.extend({wrap:"~~"}):l.tinl.extend(),l.br=l.inl.extend({wrap:["",function(){var a=k.br_only?"<br>":"  ";return this.p instanceof l.h?"<br>":a+"\n"}]}),l.strong=l.inl.extend({wrap:c(k.bold_char,2)}),l.b=l.strong.extend(),l.dl=l.tblk.extend({lnInd:2}),l.dt=l.ctblk.extend(),l.dd=l.ctblk.extend(),l.sub=l.tinl.extend(),l.sup=l.tinl.extend(),l.blockquote=l.blk.extend({lnPfx:"> ",rend:function(){return this.supr().replace(/>[ \t]$/gm,">")}}),l.pre=l.blk.extend({tagr:!0,wrapK:"\n",lnInd:0}),l.code=l.blk.extend({tagr:!1,wrap:"",wrapK:function(a){return-1!==a.indexOf("`")?"``":"`"},lnInd:0,init:function(a,b,c){if(this.supr(a,b,c),this.p instanceof l.pre)if(this.p.tagr=!1,k.gfm_code){var d=this.e.getAttribute("class");d=(d||"").split(" ")[0],0===d.indexOf("lang-")&&(d=d.substr(5)),this.wrapK=["```"+d+"\n","\n```"]}else this.wrapK="",this.p.lnInd=4}}),l.table=k.gfm_tbls?l.blk.extend({cols:[],init:function(a,b,c){this.supr(a,b,c),this.cols=[]},rend:function(){for(var a in this.c)for(var b in this.c[a].c)for(var c in this.c[a].c[b].c)this.c[a].c[b].c[c].prep();return this.supr()}}):l.tblk.extend(),l.thead=k.gfm_tbls?l.cblk.extend({wrap:["\n",function(){var a="";for(var b in this.p.cols){var e=this.p.cols[b],f="c"==e.a[0]?":":" ",g="r"==e.a[0]||"c"==e.a[0]?":":" ";a+=(0==b&&k.tbl_edges?"|":"")+f+c("-",e.w)+g+(b<this.p.cols.length-1||k.tbl_edges?"|":"")}return"\n"+d(a)}]}):l.ctblk.extend(),l.tbody=k.gfm_tbls?l.cblk.extend():l.ctblk.extend(),l.tfoot=k.gfm_tbls?l.cblk.extend():l.ctblk.extend(),l.tr=k.gfm_tbls?l.cblk.extend({wrapK:[k.tbl_edges?"| ":"",k.tbl_edges?" |":""]}):l.ctblk.extend(),l.th=k.gfm_tbls?l.inl.extend({guts:null,wrap:[function(){var a,b=this.p.p.p.cols[this.i],d=0==this.i?"":" ",e=b.w-this.guts.length;switch(b.a[0]){case"r":a=c(" ",e);break;case"c":a=c(" ",Math.floor(e/2));break;default:a=""}return d+a},function(){var a,b=this.p.p.p.cols[this.i],d=this.i==this.p.c.length-1?"":" |",e=b.w-this.guts.length;switch(b.a[0]){case"r":a="";break;case"c":a=c(" ",Math.ceil(e/2));break;default:a=c(" ",e)}return a+d}],prep:function(){this.guts=this.rendK(),this.rendK=function(){return this.guts};var a=this.p.p.p.cols;a[this.i]||(a[this.i]={w:null,a:""});var b=a[this.i];b.w=Math.max(b.w||0,this.guts.length),this.e.align&&(b.a=this.e.align)}}):l.ctblk.extend(),l.td=l.th.extend(),l.txt=l.inl.extend({initK:function(){this.c=this.e.textContent.split(/^/gm)},rendK:function(){var a=this.c.join("").replace(/\r/gm,"");return this.p instanceof l.code||this.p instanceof l.pre||(a=a.replace(/^\s*#/gm,"\\#").replace(/\*/gm,"\\*")),0==this.i&&(a=a.replace(/^\n+/,"")),this.i==this.p.c.length-1&&(a=a.replace(/\n+$/,"")),a}})},!function(a,b){"function"==typeof define?define(b):"undefined"!=typeof module?module.exports=b():this[a]=b()}("klass",function(){function a(a){return e.call(b(a)?a:function(){},a,1)}function b(a){return typeof a===h}function c(a,b,c){return function(){var d=this.supr;this.supr=c[j][a];var e=b.apply(this,arguments);return this.supr=d,e}}function d(a,d,e){for(var f in d)d.hasOwnProperty(f)&&(a[f]=b(d[f])&&b(e[j][f])&&i.test(d[f])?c(f,d[f],e):d[f])}function e(a,c){function e(){}function f(){this.init?this.init.apply(this,arguments):(c||i&&g.apply(this,arguments),k.apply(this,arguments))}e[j]=this[j];var g=this,h=new e,i=b(a),k=i?a:this,l=i?{}:a;return f.methods=function(a){return d(h,a,g),f[j]=h,this},f.methods.call(f,l).prototype.constructor=f,f.extend=arguments.callee,f[j].implement=f.statics=function(a,b){return a="string"==typeof a?function(){var c={};return c[a]=b,c}():a,d(this,a,g),this},f}var f=this,g=f.klass,h="function",i=/xyz/.test(function(){})?/\bsupr\b/:/.*/,j="prototype";return a.noConflict=function(){return f.klass=g,this},f.klass=a,a});var Showdown={extensions:{}},forEach=Showdown.forEach=function(a,b){if("function"==typeof a.forEach)a.forEach(b);else{var c,d=a.length;for(c=0;d>c;c++)b(a[c],c,a)}},stdExtName=function(a){return a.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(a){var b,c,d,e=0,f=[],g=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var h=require("fs");if(h){var i=h.readdirSync((__dirname||".")+"/extensions").filter(function(a){return~a.indexOf(".js")}).map(function(a){return a.replace(/\.js$/,"")});Showdown.forEach(i,function(a){var b=stdExtName(a);Showdown.extensions[b]=require("./extensions/"+a)})}}if(this.makeHtml=function(a){return b={},c={},d=[],a=a.replace(/~/g,"~T"),a=a.replace(/\$/g,"~D"),a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a="\n\n"+a+"\n\n",a=M(a),a=a.replace(/^[ \t]+$/gm,""),Showdown.forEach(f,function(b){a=l(b,a)}),a=z(a),a=n(a),a=m(a),a=p(a),a=K(a),a=a.replace(/~D/g,"$$"),a=a.replace(/~T/g,"~"),Showdown.forEach(g,function(b){a=l(b,a)}),a},a&&a.extensions){var j=this;Showdown.forEach(a.extensions,function(a){if("string"==typeof a&&(a=Showdown.extensions[stdExtName(a)]),"function"!=typeof a)throw"Extension '"+a+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(a(j),function(a){a.type?"language"===a.type||"lang"===a.type?f.push(a):("output"===a.type||"html"===a.type)&&g.push(a):g.push(a)})})}var k,l=function(a,b){if(a.regex){var c=new RegExp(a.regex,"g");return b.replace(c,a.replace)}return a.filter?a.filter(b):void 0},m=function(a){return a+="~0",a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(a,d,e,f,g){return d=d.toLowerCase(),b[d]=G(e),f?f+g:(g&&(c[d]=g.replace(/"/g,"&quot;")),"")}),a=a.replace(/~0/,"")},n=function(a){return a=a.replace(/\n/g,"\n\n"),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,o),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,o),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,o),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,o),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,o),a=a.replace(/\n\n/g,"\n")},o=function(a,b){var c=b;return c=c.replace(/\n\n/g,"\n"),c=c.replace(/^\n/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(d.push(c)-1)+"K\n\n"},p=function(a){a=w(a);var b=A("<hr />");return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=x(a),a=y(a),a=E(a),a=n(a),a=F(a)},q=function(a){return a=B(a),a=r(a),a=H(a),a=u(a),a=s(a),a=I(a),a=G(a),a=D(a),a=a.replace(/  +\n/g," <br />\n")},r=function(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=N(b,"\\`*_")})},s=function(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,t),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,t),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,t)},t=function(a,d,e,f,g,h,i,j){void 0==j&&(j="");var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(""==n)if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0!=b[m])n=b[m],void 0!=c[m]&&(o=c[m]);else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}n=N(n,"*_");var p='<a href="'+n+'"';return""!=o&&(o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>"},u=function(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,v),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,v)},v=function(a,d,e,f,g,h,i,j){var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(o||(o=""),""==n){if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0==b[m])return k;n=b[m],void 0!=c[m]&&(o=c[m])}l=l.replace(/"/g,"&quot;"),n=N(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"',p+=" />"},w=function(a){function b(a){return a.replace(/[^\w]/g,"").toLowerCase()}return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,c){return A('<h1 id="'+b(c)+'">'+q(c)+"</h1>")}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,c){return A('<h2 id="'+b(c)+'">'+q(c)+"</h2>")}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,c,d){var e=c.length;return A("<h"+e+' id="'+b(d)+'">'+q(d)+"</h"+e+">")})},x=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return e?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol";d=d.replace(/\n{2,}/g,"\n\n\n");var f=k(d);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",f=f.replace(/\n{2,}/g,"\n\n\n"),h=k(f);return h=e+"<"+g+">\n"+h+"</"+g+">\n"})),a=a.replace(/~0/,"")};k=function(a){return e++,a=a.replace(/\n{2,}$/,"\n"),a+="~0",a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){var f=e,g=b;return g||f.search(/\n{2,}/)>-1?f=p(L(f)):(f=x(L(f)),f=f.replace(/\n$/,""),f=q(f)),"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),e--,a};var y=function(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=C(L(d)),d=M(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>",A(d)+e}),a=a.replace(/~0/,"")},z=function(a){return a+="~0",a=a.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(a,b,c){var d=b,e=c;return e=C(e),e=M(e),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,""),e="<pre><code"+(d?' class="'+d+'"':"")+">"+e+"\n</code></pre>",A(e)}),a=a.replace(/~0/,"")},A=function(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(d.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){var e=d;return e=e.replace(/^([ \t]*)/g,""),e=e.replace(/[ \t]*$/g,""),e=C(e),b+"<code>"+e+"</code>"})},C=function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=N(a,"*_{}[]\\",!1)},D=function(a){return a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},E=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=p(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /gm,"~0"),c=c.replace(/~0/g,"")}),A("<blockquote>\n"+c+"\n</blockquote>")})},F=function(a){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var b=a.split(/\n{2,}/g),c=[],e=b.length,f=0;e>f;f++){var g=b[f];g.search(/~K(\d+)K/g)>=0?c.push(g):g.search(/\S/)>=0&&(g=q(g),g=g.replace(/^([ \t]*)/g,"<p>"),g+="</p>",c.push(g))}e=c.length;for(var f=0;e>f;f++)for(;c[f].search(/~K(\d+)K/)>=0;){var h=d[RegExp.$1];h=h.replace(/\$/g,"$$$$"),c[f]=c[f].replace(/~K\d+K/,h)}return c.join("\n\n")},G=function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},H=function(a){return a=a.replace(/\\(\\)/g,O),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,O)},I=function(a){return a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return J(K(b))
})},J=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+a.charCodeAt(0).toString(16)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if("@"==a)a=b[Math.floor(2*Math.random())](a);else if(":"!=a){var c=Math.random();a=c>.9?b[2](a):c>.45?b[1](a):b[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">')},K=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},L=function(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,"")},M=function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,e=0;d>e;e++)c+=" ";return c}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,"")},N=function(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,O)},O=function(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",function(){return Showdown});var MoleskineModule=angular.module("MoleskineModule",[]);MoleskineModule.directive("moleskine",[function(){var a={restrict:"E",replace:!0,scope:{bindData:"=",baseContent:"=",width:"@",height:"@",input:"@",output:"@",defaultMode:"@",cssClass:"@",autoGrow:"@"},template:"<textarea></textarea>"};return a.controller=["$scope",function(){}],a.link=function(a,b){var c=$(b).moleskine({width:a.width,height:a.height,defaultMode:a.defaultMode,input:a.input,output:a.output,autoGrow:a.autoGrow,change:function(b,c){var d=a.$root.$$phase;a.bindData=c,"$apply"!=d&&"$digest"!=d&&a.$apply()}});c.set_content(a.baseContent),a.$watch("baseContent",function(a,b){a!=b&&c.set_content(a)})},a}]);